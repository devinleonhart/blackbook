#!/bin/bash

# Complete development environment setup for Blackbook
# This script follows Rails conventions for development setup

set -e

echo "ğŸš€ Setting up Blackbook development environment..."

# Check if Docker is running
if ! docker info > /dev/null 2>&1; then
  echo "âŒ Docker is not running. Please start Docker and try again."
  exit 1
fi

# Start containers
echo "ğŸ³ Starting Docker containers..."
docker compose up -d

# Wait for database to be ready
echo "â³ Waiting for database to be ready..."
sleep 10

# Setup database
echo "ğŸ—„ï¸  Setting up database..."
docker compose exec blackbook bundle exec rails db:create
docker compose exec blackbook bundle exec rails db:migrate
docker compose exec blackbook bundle exec rails db:seed

# Setup test database
echo "ğŸ§ª Setting up test database..."
docker compose exec blackbook bundle exec rails db:create RAILS_ENV=test
docker compose exec blackbook bundle exec rails db:migrate RAILS_ENV=test
docker compose exec blackbook bundle exec rails db:seed RAILS_ENV=test

echo ""
echo "ğŸ‰ Development environment ready!"
echo ""
echo "ğŸŒ Application: http://localhost:3001"
echo ""
echo "ğŸ” Test accounts:"
echo "  Admin: admin@blackbook.dev / password123"
echo "  Writer: writer@blackbook.dev / password123"
echo "  Collaborator: collaborator@blackbook.dev / password123"
echo ""
echo "ğŸ’¡ Useful commands:"
echo "  bin/rails db:dev_reset    - Reset development database"
echo "  bin/rails db:test_reset   - Reset test database"
echo "  bin/rails db:stats        - Show database statistics"
echo "  docker compose logs       - View application logs"
echo "  docker compose down       - Stop containers"
