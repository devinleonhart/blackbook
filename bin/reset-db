#!/bin/bash

# Reset and seed the development database (Docker).

set -e

echo "Resetting development database..."

# Stop containers if running
docker compose down

echo "Starting database..."
docker compose up -d postgres_db

echo "Waiting for database..."
for i in $(seq 1 30); do
  if docker compose exec -T postgres_db pg_isready -U postgres >/dev/null 2>&1; then
    break
  fi
  sleep 1
done

echo "Resetting database..."
docker compose run --rm -e RAILS_ENV=development blackbook bundle exec rails db:reset

echo "Starting app..."
docker compose up -d blackbook

echo "Database reset complete."
echo "Accounts:"
echo "  Admin: admin@blackbook.dev / password123"
echo "  Owner: owner@blackbook.dev / password123"
echo "  Collaborator: collaborator@blackbook.dev / password123"
