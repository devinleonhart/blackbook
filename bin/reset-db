#!/bin/bash

# Reset and seed database for development
# This script follows Rails conventions for database management

set -e

echo "ğŸ”„ Resetting development database..."

# Stop containers if running
echo "ğŸ›‘ Stopping containers..."
docker compose down

# Remove database volume to start fresh (optional - comment out to keep data)
# echo "ğŸ—‘ï¸  Removing database volume..."
# docker volume rm blackbook_db_data

# Start containers
echo "ğŸ³ Starting containers..."
docker compose up -d

# Wait for database to be ready
echo "â³ Waiting for database to be ready..."
sleep 10

# Reset and seed database
echo "ğŸ—„ï¸  Resetting and seeding database..."
docker compose exec blackbook bundle exec rails db:reset

echo "âœ… Database reset and seeded successfully!"
echo ""
echo "ğŸ” Test accounts:"
echo "  Admin: admin@blackbook.dev / password123"
echo "  Writer: writer@blackbook.dev / password123"
echo "  Collaborator: collaborator@blackbook.dev / password123"
