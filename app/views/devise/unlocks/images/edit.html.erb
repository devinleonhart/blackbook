<% render partial: "shared/capture_navbar" %>

<section class="images-edit-view">

  <div class="max-w-6xl mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 bg-white rounded-lg p-4 shadow border border-gray-200 flex justify-center">
        <%= link_to rails_blob_path(@image.image_file, disposition: "attachment") do %>
          <%= generate_image_tag(@image, [1000]) %>
        <% end %>
      </div>

      <div class="bg-white rounded-lg p-6 shadow border border-gray-200">
        <ul class="space-y-2">
          <% if @image.image_tags.empty? %>
            <li>There are no characters in this image.</li>
          <% else %>
            <h3 class="text-lg font-semibold text-gray-900">This image contains...</h3>
            <% @image.image_tags.each do | tag | %>
              <li class="flex items-center justify-between gap-3">
                <%= link_to "#{tag.character.name}", character_url(tag.character), class: "bb-link" %>
                <%= link_to image_tag_url(tag), method: "delete", class: "text-red-600 hover:text-red-800", aria: { label: "Remove tag" } do %>
                  âœ•
                <% end %>
              </li>
            <% end %>
          <% end %>
        </ul>

        <% if @image.universe.characters.empty? %>
          <ul class="mt-4">
            <li>There are no characters in this universe to link to this image.</li>
          </ul>
        <% else %>
          <h3 class="text-lg font-semibold text-gray-900 mt-6">You could add...</h3>
          <%= form_with model: ImageTag.new(), url: universe_image_image_tags_url(@image.universe, @image), method: "post", class: "mt-2 flex items-center gap-2" do |form| %>
            <%= form.select :character_id, generate_character_names(@image.universe.characters, @image.image_tags), { include_blank: true }, class: "bb-input" %>
            <%= form.submit "Add", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
          <% end %>
        <% end %>

        <%= form_with model: @image, url: universe_image_url(@image.universe, @image), method: "patch", class: "mt-6 space-y-2" do |form| %>
          <%= form.label :caption, "Caption", class: "block text-sm font-medium text-gray-700" %>
          <%= form.text_field :caption, class: "bb-input" %>
          <div class="flex items-center gap-2">
            <%= form.submit "Update", class: "bg-gray-100 hover:bg-gray-200 text-gray-900 font-bold py-2 px-4 rounded border border-gray-200" %>
            <%= link_to "Delete", universe_image_url(@image), method: "delete", data: { confirm: "Are you sure?" }, class: "bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" %>
          </div>
        <% end %>
      </div>

    </div>
  </div>

</section>
