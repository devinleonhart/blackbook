<div class="character-selector">
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">Characters (<%= characters.count %>)</label>
    <div class="mb-4">
      <input class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" type="text" id="character-search-<%= unique_id %>" placeholder="Search characters..." onkeyup="filterCharacters('<%= unique_id %>')">
    </div>
    <div id="character-results-<%= unique_id %>" class="character-results max-h-80 overflow-y-auto border border-gray-200 rounded-md bg-white">
      <% characters.sort_by {|c| c.name }.each do |character| %>
        <div class="character-item p-3 border-b border-gray-100 hover:bg-gray-50">
          <%= link_to character.name, character_path(character), class: "text-blue-600 hover:text-blue-800 hover:underline" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
if (typeof window.filterCharacters === 'undefined') {
  window.filterCharacters = function(uniqueId) {
    const searchTerm = document.getElementById(`character-search-${uniqueId}`).value.toLowerCase();
    const characterItems = document.querySelectorAll(`#character-results-${uniqueId} .character-item`);

    characterItems.forEach(item => {
      const characterName = item.textContent.toLowerCase();
      if (characterName.includes(searchTerm)) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  }
}
</script>
