<div>
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">Characters (<%= characters.count %>)</label>
    <div class="mb-4">
      <input class="bb-input" type="text" id="character-search-<%= unique_id %>" placeholder="Search characters..." onkeyup="filterCharacters('<%= unique_id %>')">
    </div>
    <div id="character-results-<%= unique_id %>" data-character-results class="max-h-80 overflow-y-auto border border-gray-200 rounded-md bg-white">
      <% characters.sort_by {|c| c.name }.each do |character| %>
        <div data-character-item class="p-3 border-b border-gray-100 hover:bg-gray-50">
          <%= link_to character.name, character_path(character), class: "bb-link" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
window.filterCharacters = function(uniqueId) {
  const searchTerm = document.getElementById(`character-search-${uniqueId}`).value.toLowerCase();
  const characterItems = document.querySelectorAll(`#character-results-${uniqueId} [data-character-item]`);

  characterItems.forEach(item => {
    const characterName = item.textContent.toLowerCase();
    if (characterName.includes(searchTerm)) {
      item.style.display = 'block';
    } else {
      item.style.display = 'none';
    }
  });
}
</script>
